## データベース工学最終課題

このリポジトリは、配布PDFの課題に対して **SQLを手元で実行して結果確認できる環境（SQLite）** をまとめたものです。

### 前提

- `sqlite3` が使えること（macOSなら通常利用できます）

### 使い方（最短）

```bash
# 課題その1
sh scripts/run_kadai1_sqlite.sh

# 課題その2
sh scripts/run_kadai2_sqlite.sh
```

### 注意

- 生成されるDB（`data/*.sqlite3`）は **生成物** なのでgit管理しません（`.gitignore` 済み）。

### ディレクトリ構成

- **`sql/kadai1/`**: 課題その1（PDF）のスキーマ・データ・クエリ
- **`sql/kadai2/`**: 課題その2（作問用ミニDB・作問5題＋模範解答）
- **`scripts/`**: SQLite実行スクリプト
- **`data/`**: 実行で生成されるSQLite DB（git管理しない）

以下の3種類の課題（課題その1～その3）をすべておこない、A4レポート用紙に記入して1つのPDFファイルとして提出して下さい。

### ■課題その1
添付ファイルにある課題について、解答をSQL文で記述しなさい。小問は複数あるので、どの問題の解答かがわかるように、小問の番号を付して下さい。

### ■課題その2
「課題その1」を参考にして、SQL文を問う問題を自分で作成し、その模範解答も示しなさい。作成にあたっては、以下の条件を満たすようにすること。

【作問に関する条件】
(1) 必ず2つ以上の表を用いて問題を作成する。
(2) 用いる表のリレーションスキーマを全て正しく記述する。
(3) 小問は5題作成する。
(4) 小問のうち3題以上は、複数の表を参照しなければ解けないものとする。
(5) 小問のうち1題以上は、入れ子型質問を用いなければ解けないものとする。

なお、模範解答は、どの小問の解答かがわかるように記述して下さい。書き方は自由で、設問を全て書いた後に模範解答を書いても、小問ごとに設問と解答を書いても構いません。また、複数の正答がある場合でも模範解答は種類で良いものとします（もちろん複数書いても構いません）。

■課題その3
データベース工学を学ぶことが、あなたの今後にとってどのような意義を持つと思うか、あなたの考えを述べなさい。

---

### 課題その1（PDFのSQL）を手元で確認する環境（SQLite）

このリポジトリには、PDF「2024年度データベース工学レポート課題(その1)」に掲載されている
4つのリレーション（会員・身体計測・選択・運動強度）とサンプルデータを **SQLite** で再現し、
小問(1)〜(7)のSQLを実行して結果を確認できる環境を用意しています。

- **スキーマ**: `sql/kadai1/01_schema.sql`
- **サンプルデータ投入**: `sql/kadai1/02_seed.sql`
- **小問(1)〜(7)のSQL**: `sql/kadai1/03_queries.sql`
- **実行スクリプト**: `scripts/run_kadai1_sqlite.sh`

#### 実行方法

macOS（`sqlite3` が利用できる前提）で、プロジェクトルートから以下を実行してください。

```bash
sh scripts/run_kadai1_sqlite.sh
```

実行すると `data/kadai1.sqlite3` が作成され、(1)〜(7)の結果がターミナルに表示されます。

#### サンプルテーブル（スキーマとデータ）

**リレーション（スキーマ）**:

- 会員（会員番号, 氏名, 性別, 年齢）
- 身体計測（会員番号, 身長(cm), 体重(kg)）
- 選択（会員番号, メニュー）
- 運動強度（メニュー, 強度）

**サンプルデータ（`sql/kadai1/02_seed.sql`）**:

会員

| 会員番号 | 氏名 | 性別 | 年齢 |
| --- | --- | --- | --- |
| 101 | 中央太郎 | 男 | 49 |
| 102 | 草野みどり | 女 | 35 |
| 103 | 白門次郎 | 男 | 52 |
| 104 | 赤井花子 | 女 | 77 |
| 105 | 多摩三郎 | 男 | 23 |
| 106 | 森野めぐみ | 女 | 38 |

身体計測

| 会員番号 | 身長(cm) | 体重(kg) |
| --- | --- | --- |
| 101 | 175.5 | 78.5 |
| 102 | 158.0 | 61.5 |
| 103 | 168.7 | 73.2 |
| 104 | 148.6 | 55.5 |
| 105 | 182.5 | 68.9 |
| 106 | 164.2 | 52.3 |

選択

| 会員番号 | メニュー |
| --- | --- |
| 101 | ウォーキング |
| 102 | ヨガ |
| 103 | 水中ウォーキング |
| 104 | ジョギング |
| 105 | 縄跳び |
| 106 | スイミング |

運動強度

| メニュー | 強度 |
| --- | --- |
| ウォーキング | 小 |
| ヨガ | 小 |
| 水中ウォーキング | 中 |
| ジョギング | 中 |
| 縄跳び | 大 |
| スイミング | 大 |

---

### 課題その2（作問5題＋模範解答）を手元で確認する環境（SQLite）

課題その2は「課題その1を参考にしてSQL問題を5題作成し、模範解答も示す」課題なので、
作問しやすいミニDB（大学の履修・成績）を用意し、**作問5題＋模範解答SQL** を `SQLite` で実行して確認できるようにしています。

- **スキーマ**: `sql/kadai2/01_schema.sql`
- **サンプルデータ投入**: `sql/kadai2/02_seed.sql`
- **作問5題＋模範解答SQL**: `sql/kadai2/03_queries.sql`
- **実行スクリプト**: `scripts/run_kadai2_sqlite.sh`

#### 実行方法

```bash
sh scripts/run_kadai2_sqlite.sh
```

実行すると `data/kadai2.sqlite3` が作成され、問1〜問5の結果がターミナルに表示されます。

#### サンプルテーブル（スキーマとデータ）

**リレーション（スキーマ）**:

- 学科（学科ID, 学科名）
- 教員（教員ID, 氏名, 学科ID）
- 学生（学籍番号, 氏名, 学年, 学科ID）
- 科目（科目ID, 科目名, 単位, 学科ID, 担当教員ID）
- 履修（履修ID, 学籍番号, 科目ID, 点数）

**サンプルデータ（`sql/kadai2/02_seed.sql`）**:

学科

| 学科ID | 学科名 |
| --- | --- |
| CS | 情報工学科 |
| EE | 電気電子工学科 |
| BA | 経営学科 |

教員

| 教員ID | 氏名 | 学科ID |
| --- | --- | --- |
| 1 | 佐藤教授 | CS |
| 2 | 鈴木准教授 | CS |
| 3 | 田中教授 | EE |
| 4 | 高橋講師 | BA |
| 5 | 未担当教員 | BA |

学生

| 学籍番号 | 氏名 | 学年 | 学科ID |
| --- | --- | --- | --- |
| 1001 | 青木一郎 | 2 | CS |
| 1002 | 石井花 | 3 | CS |
| 1003 | 上田健 | 1 | EE |
| 1004 | 大野美咲 | 4 | BA |
| 1005 | 加藤誠 | 2 | BA |

科目

| 科目ID | 科目名 | 単位 | 学科ID | 担当教員ID |
| --- | --- | --- | --- | --- |
| CS101 | データベース基礎 | 2 | CS | 1 |
| CS102 | アルゴリズム | 2 | CS | 2 |
| EE101 | 回路理論 | 2 | EE | 3 |
| BA101 | 経営学入門 | 2 | BA | 4 |
| CS201 | データベース応用 | 2 | CS | 1 |

履修

| 履修ID | 学籍番号 | 科目ID | 点数 |
| --- | --- | --- | --- |
| 1 | 1001 | CS101 | 78 |
| 2 | 1001 | CS102 | 65 |
| 3 | 1001 | CS201 | 81 |
| 4 | 1002 | CS101 | 92 |
| 5 | 1002 | CS102 | 88 |
| 6 | 1003 | EE101 | 70 |
| 7 | 1004 | BA101 | 83 |
| 8 | 1004 | CS101 | 55 |
| 9 | 1005 | BA101 | 61 |

#### 作問（問題）と模範解答（SQL）

※実体は `sql/kadai2/03_queries.sql` にあります（提出用にREADMEにも転記）。

##### 問1（集計）

**問題**: 学年ごとの学生数を求めよ。  
**模範解答（SQL）**:

```sql
SELECT "学年", COUNT(*) AS "学生数"
FROM "学生"
GROUP BY "学年"
ORDER BY "学年";
```

##### 問2（複数表参照：学生×履修）

**問題**: 各学生について、履修している科目数と平均点を表示せよ（学生名も表示すること）。  
**模範解答（SQL）**:

```sql
SELECT s."学籍番号",
       s."氏名",
       COUNT(e."科目ID") AS "履修科目数",
       ROUND(AVG(e."点数"), 2) AS "平均点"
FROM "学生" s
LEFT JOIN "履修" e ON e."学籍番号" = s."学籍番号"
GROUP BY s."学籍番号", s."氏名"
ORDER BY s."学籍番号";
```

##### 問3（複数表参照：学生×履修×学科）

**問題**: 学科ごとの平均点を求めよ（履修の点数を用いる）。  
**模範解答（SQL）**:

```sql
SELECT d."学科名",
       ROUND(AVG(e."点数"), 2) AS "学科平均点"
FROM "履修" e
JOIN "学生" s ON s."学籍番号" = e."学籍番号"
JOIN "学科" d ON d."学科ID" = s."学科ID"
GROUP BY d."学科ID", d."学科名"
ORDER BY d."学科ID";
```

##### 問4（入れ子型質問：相関サブクエリ）※複数表参照

**問題**: 各科目について、「その科目の平均点以上」を取った学生の氏名・科目名・点数を表示せよ。  
**模範解答（SQL）**:

```sql
SELECT s."氏名",
       c."科目名",
       e."点数"
FROM "履修" e
JOIN "学生" s ON s."学籍番号" = e."学籍番号"
JOIN "科目" c ON c."科目ID" = e."科目ID"
WHERE e."点数" >= (
  SELECT AVG(e2."点数")
  FROM "履修" e2
  WHERE e2."科目ID" = e."科目ID"
)
ORDER BY c."科目ID", e."点数" DESC, s."学籍番号";
```

##### 問5（NOT EXISTS）

**問題**: どの科目も担当していない教員の氏名を表示せよ。  
**模範解答（SQL）**:

```sql
SELECT t."教員ID",
       t."氏名"
FROM "教員" t
WHERE NOT EXISTS (
  SELECT 1
  FROM "科目" c
  WHERE c."担当教員ID" = t."教員ID"
)
ORDER BY t."教員ID";
```